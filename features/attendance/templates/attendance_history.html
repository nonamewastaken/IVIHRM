{% extends "base.html" %}

{% block title %}Attendance History - HRM System{% endblock %}

{% block page_title %}<i class="fas fa-history"></i> Attendance History{% endblock %}

{% block extra_css %}
<style>
    /* Attendance History specific styles */
    .history-container {
        max-width: 100%;
    }
    
    .history-card {
        background: white;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .filter-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .filter-row {
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .filter-group label {
        font-weight: 600;
        color: #333;
        font-size: 0.9rem;
    }

    .filter-group input,
    .filter-group select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 0.9rem;
    }

    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-primary {
        background: #007bff;
        color: white;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .history-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    .history-table th,
    .history-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    
    .history-table th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: #333;
    }

    .history-table tr:hover {
        background-color: #f5f5f5;
    }
    
    .status-present {
        color: #28a745;
        font-weight: 600;
    }
    
    .status-late {
        color: #ffc107;
        font-weight: 600;
    }

    .status-absent {
        color: #dc3545;
        font-weight: 600;
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }

    .pagination button {
        padding: 8px 12px;
        border: 1px solid #ddd;
        background: white;
        cursor: pointer;
        border-radius: 4px;
    }

    .pagination button:hover {
        background: #f8f9fa;
    }

    .pagination button.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }
</style>
{% endblock %}

{% block content %}
<div class="history-container">
    <div class="history-card">
        <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">
                <i class="fas fa-history"></i> <span id="attendanceHistoryTitle">Attendance History</span>
        </h1>
        
            <!-- Filter Section -->
        <div class="filter-section">
                <h3 style="margin-bottom: 15px; color: #333;">
                    <i class="fas fa-filter"></i> <span id="filterRecordsTitle">Filter Records</span>
                </h3>
            <div class="filter-row">
                    <div class="filter-group">
                        <label for="employeeSelect" id="employeeLabel">Employee</label>
                        <select id="employeeSelect">
                            <option value="" id="allEmployeesOption">All Employees</option>
                            <option value="1">John Doe</option>
                            <option value="2">Jane Smith</option>
                            <option value="3">Mike Johnson</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="dateFrom" id="fromDateLabel">From Date</label>
                        <input type="date" id="dateFrom">
                    </div>
                    <div class="filter-group">
                        <label for="dateTo" id="toDateLabel">To Date</label>
                        <input type="date" id="dateTo">
                    </div>
                    <div class="filter-group">
                        <label for="statusSelect" id="statusLabel">Status</label>
                        <select id="statusSelect">
                            <option value="" id="allStatusOption">All Status</option>
                            <option value="present" id="statusPresentOption">Present</option>
                            <option value="late" id="statusLateOption">Late</option>
                            <option value="absent" id="statusAbsentOption">Absent</option>
                        </select>
                </div>
                    <div class="filter-group">
                        <button class="btn btn-primary" onclick="filterRecords()">
                            <i class="fas fa-search"></i> <span id="filterButtonText">Filter</span>
                        </button>
                </div>
                    <div class="filter-group">
                        <button class="btn btn-secondary" onclick="clearFilters()">
                            <i class="fas fa-times"></i> <span id="clearButtonText">Clear</span>
                </button>
            </div>
            </div>
        </div>
        
            <!-- History Table -->
            <div style="overflow-x: auto;">
                <table class="history-table">
                <thead>
                    <tr>
                            <th id="tableHeaderDate">Date</th>
                            <th id="tableHeaderEmployee">Employee</th>
                            <th id="tableHeaderCheckIn">Check In</th>
                            <th id="tableHeaderCheckOut">Check Out</th>
                            <th id="tableHeaderWorkHours">Work Hours</th>
                            <th id="tableHeaderStatus">Status</th>
                            <th id="tableHeaderNotes">Notes</th>
                    </tr>
                </thead>
                    <tbody>
                        <tr>
                            <td>2024-01-15</td>
                            <td>John Doe</td>
                            <td>09:00</td>
                            <td>17:30</td>
                            <td>8.5</td>
                            <td><span class="status-present" data-status="present">Present</span></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>2024-01-15</td>
                            <td>Jane Smith</td>
                            <td>08:45</td>
                            <td>18:00</td>
                            <td>9.25</td>
                            <td><span class="status-present" data-status="present">Present</span></td>
                            <td>Overtime</td>
                        </tr>
                        <tr>
                            <td>2024-01-15</td>
                            <td>Mike Johnson</td>
                            <td>09:15</td>
                            <td>17:45</td>
                            <td>8.5</td>
                            <td><span class="status-late" data-status="late">Late</span></td>
                            <td>Traffic delay</td>
                        </tr>
                        <tr>
                            <td>2024-01-14</td>
                            <td>Sarah Wilson</td>
                            <td>09:00</td>
                            <td>16:30</td>
                            <td>7.5</td>
                            <td><span class="status-present" data-status="present">Present</span></td>
                            <td>Early leave - appointment</td>
                        </tr>
                        <tr>
                            <td>2024-01-14</td>
                            <td>David Brown</td>
                            <td>-</td>
                            <td>-</td>
                            <td>0</td>
                            <td><span class="status-absent" data-status="absent">Absent</span></td>
                            <td>Sick leave</td>
                        </tr>
                        <tr>
                            <td>2024-01-13</td>
                            <td>John Doe</td>
                            <td>08:30</td>
                            <td>17:00</td>
                            <td>8.5</td>
                            <td><span class="status-present" data-status="present">Present</span></td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>2024-01-13</td>
                            <td>Jane Smith</td>
                            <td>09:00</td>
                            <td>18:30</td>
                            <td>9.5</td>
                            <td><span class="status-present" data-status="present">Present</span></td>
                            <td>Overtime</td>
                        </tr>
                        <tr>
                            <td>2024-01-13</td>
                            <td>Mike Johnson</td>
                            <td>09:00</td>
                            <td>17:30</td>
                            <td>8.5</td>
                            <td><span class="status-present" data-status="present">Present</span></td>
                            <td>-</td>
                        </tr>
                </tbody>
            </table>
        </div>
        
            <!-- Pagination -->
            <div class="pagination">
                <button onclick="changePage(1)">«</button>
                <button onclick="changePage(1)" class="active">1</button>
                <button onclick="changePage(2)">2</button>
                <button onclick="changePage(3)">3</button>
                <button onclick="changePage(4)">4</button>
                <button onclick="changePage(5)">5</button>
                <button onclick="changePage(5)">»</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
// Function to update Attendance History translations
function updateAttendanceHistoryTranslations() {
    if (!window.t) return;
    
    // Title
    const titleEl = document.getElementById('attendanceHistoryTitle');
    if (titleEl) {
        titleEl.textContent = window.t('ui.sidebar.attendance.attendanceHistoryTitle', 'Attendance History');
    }
    
    // Filter section
    const filterRecordsEl = document.getElementById('filterRecordsTitle');
    if (filterRecordsEl) {
        filterRecordsEl.textContent = window.t('ui.sidebar.attendance.filterRecords', 'Filter Records');
    }
    
    // Filter labels
    const employeeLabelEl = document.getElementById('employeeLabel');
    if (employeeLabelEl) {
        employeeLabelEl.textContent = window.t('ui.sidebar.attendance.employee', 'Employee');
    }
    
    const fromDateLabelEl = document.getElementById('fromDateLabel');
    if (fromDateLabelEl) {
        fromDateLabelEl.textContent = window.t('ui.sidebar.attendance.fromDate', 'From Date');
    }
    
    const toDateLabelEl = document.getElementById('toDateLabel');
    if (toDateLabelEl) {
        toDateLabelEl.textContent = window.t('ui.sidebar.attendance.toDate', 'To Date');
    }
    
    const statusLabelEl = document.getElementById('statusLabel');
    if (statusLabelEl) {
        statusLabelEl.textContent = window.t('ui.sidebar.attendance.status', 'Status');
    }
    
    // Filter options
    const allEmployeesOptionEl = document.getElementById('allEmployeesOption');
    if (allEmployeesOptionEl) {
        allEmployeesOptionEl.textContent = window.t('ui.sidebar.attendance.allEmployees', 'All Employees');
    }
    
    const allStatusOptionEl = document.getElementById('allStatusOption');
    if (allStatusOptionEl) {
        allStatusOptionEl.textContent = window.t('ui.sidebar.attendance.allStatus', 'All Status');
    }
    
    const statusPresentOptionEl = document.getElementById('statusPresentOption');
    if (statusPresentOptionEl) {
        statusPresentOptionEl.textContent = window.t('ui.sidebar.attendance.present', 'Present');
    }
    
    const statusLateOptionEl = document.getElementById('statusLateOption');
    if (statusLateOptionEl) {
        statusLateOptionEl.textContent = window.t('ui.sidebar.attendance.late', 'Late');
    }
    
    const statusAbsentOptionEl = document.getElementById('statusAbsentOption');
    if (statusAbsentOptionEl) {
        statusAbsentOptionEl.textContent = window.t('ui.sidebar.attendance.absent', 'Absent');
    }
    
    // Buttons
    const filterButtonEl = document.getElementById('filterButtonText');
    if (filterButtonEl) {
        filterButtonEl.textContent = window.t('ui.sidebar.attendance.filter', 'Filter');
    }
    
    const clearButtonEl = document.getElementById('clearButtonText');
    if (clearButtonEl) {
        clearButtonEl.textContent = window.t('ui.sidebar.attendance.clear', 'Clear');
    }
    
    // Table headers
    const dateHeaderEl = document.getElementById('tableHeaderDate');
    if (dateHeaderEl) {
        dateHeaderEl.textContent = window.t('ui.sidebar.attendance.date', 'Date');
    }
    
    const employeeHeaderEl = document.getElementById('tableHeaderEmployee');
    if (employeeHeaderEl) {
        employeeHeaderEl.textContent = window.t('ui.sidebar.attendance.employee', 'Employee');
    }
    
    const checkInHeaderEl = document.getElementById('tableHeaderCheckIn');
    if (checkInHeaderEl) {
        checkInHeaderEl.textContent = window.t('ui.sidebar.attendance.checkIn', 'Check In');
    }
    
    const checkOutHeaderEl = document.getElementById('tableHeaderCheckOut');
    if (checkOutHeaderEl) {
        checkOutHeaderEl.textContent = window.t('ui.sidebar.attendance.checkOut', 'Check Out');
    }
    
    const workHoursHeaderEl = document.getElementById('tableHeaderWorkHours');
    if (workHoursHeaderEl) {
        workHoursHeaderEl.textContent = window.t('ui.sidebar.attendance.workHours', 'Work Hours');
    }
    
    const statusHeaderEl = document.getElementById('tableHeaderStatus');
    if (statusHeaderEl) {
        statusHeaderEl.textContent = window.t('ui.sidebar.attendance.status', 'Status');
    }
    
    const notesHeaderEl = document.getElementById('tableHeaderNotes');
    if (notesHeaderEl) {
        notesHeaderEl.textContent = window.t('ui.sidebar.attendance.notes', 'Notes');
    }
    
    // Status values in table rows
    const statusSpans = document.querySelectorAll('span[data-status]');
    statusSpans.forEach(span => {
        const statusType = span.getAttribute('data-status');
        if (statusType === 'present') {
            span.textContent = window.t('ui.sidebar.attendance.present', 'Present');
        } else if (statusType === 'late') {
            span.textContent = window.t('ui.sidebar.attendance.late', 'Late');
        } else if (statusType === 'absent') {
            span.textContent = window.t('ui.sidebar.attendance.absent', 'Absent');
        }
    });
}

// Initialize sidebar for Attendance category
document.addEventListener('DOMContentLoaded', function() {
    // Set active sidebar item
    setActiveSidebarItem('/attendance/history');
    
    // Generate sidebar for Attendance category
    // Sidebar is handled by main sidebar component
    
    // Wait for translations to be loaded, then update
    function initTranslations() {
        if (window.t && window.getCurrentLanguage) {
            updateAttendanceHistoryTranslations();
        } else {
            setTimeout(initTranslations, 100);
        }
    }
    
    initTranslations();
    
    // Listen for language changes
    window.addEventListener('languagechange', function() {
        updateAttendanceHistoryTranslations();
    });
});

// Filter functionality
function filterRecords() {
    const employee = document.getElementById('employeeSelect').value;
    const dateFrom = document.getElementById('dateFrom').value;
    const dateTo = document.getElementById('dateTo').value;
    const status = document.getElementById('statusSelect').value;
    
    console.log('Filtering records:', { employee, dateFrom, dateTo, status });
    // Implement actual filtering logic here
}

function clearFilters() {
    document.getElementById('employeeSelect').value = '';
    document.getElementById('dateFrom').value = '';
    document.getElementById('dateTo').value = '';
    document.getElementById('statusSelect').value = '';
    
    // Reload all records
    filterRecords();
}

function changePage(page) {
    console.log('Changing to page:', page);
    // Implement pagination logic here
}
</script>
{% endblock %}