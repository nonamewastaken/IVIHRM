<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Summary - HRM System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
    /* Sidebar Styles */
    .sidebar {
        width: 280px;
        background: white;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        z-index: 1000;
        overflow-y: auto;
        transition: width 0.3s ease, transform 0.3s ease;
    }

    .sidebar.collapsed {
        width: 60px;
    }

    .sidebar.collapsed .sidebar-header h2,
    .sidebar.collapsed .nav-item-text,
    .sidebar.collapsed .nav-section-title {
        opacity: 0;
        visibility: hidden;
    }

    .sidebar.collapsed .nav-item {
        justify-content: center;
        padding: 12px 0;
    }

    .sidebar.collapsed .nav-item-icon {
        margin-right: 0;
    }

    /* Main Content with Sidebar */
    .main-content-with-sidebar {
        margin-left: 280px;
        min-height: 100vh;
        transition: margin-left 0.3s ease;
    }

    .main-content-with-sidebar.sidebar-collapsed {
        margin-left: 60px;
    }

    /* Sidebar Toggle Button */
    .sidebar-toggle {
        position: fixed;
        top: 50%;
        left: 280px;
        transform: translateY(-50%);
        width: 20px;
        height: 40px;
        background: #667eea;
        border: none;
        border-radius: 0 8px 8px 0;
        color: white;
        cursor: pointer;
        z-index: 1001;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: left 0.3s ease, transform 0.3s ease;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }

    .sidebar-toggle:hover {
        background: #5a6fd8;
    }

    .sidebar-toggle.collapsed {
        left: 60px;
    }

    .sidebar-toggle i {
        transition: transform 0.3s ease;
    }

    .sidebar-toggle.collapsed i {
        transform: rotate(180deg);
    }

    .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #e0e0e0;
        background: #f8f9fa;
    }

    .sidebar-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #333;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .sidebar-nav {
        padding: 20px 0;
    }

    .nav-section {
        margin-bottom: 30px;
    }

    .nav-section-title {
        font-size: 0.8rem;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 0 20px 10px 20px;
        margin: 0;
    }

    .nav-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: #333;
        text-decoration: none;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
        cursor: pointer;
    }

    .nav-item:hover {
        background-color: #f1f3f4;
        color: #1a73e8;
    }

    .nav-item.active {
        background-color: #e8f0fe;
        color: #1a73e8;
        border-left-color: #1a73e8;
        font-weight: 500;
    }

    .nav-item-icon {
        width: 20px;
        height: 20px;
        margin-right: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .nav-item-text {
        font-size: 0.9rem;
    }

    /* Content Area */
    .content-area {
        padding: 20px;
        background: #f5f5f5;
        min-height: 100vh;
    }

    .attendance-container {
        max-width: 100%;
    }

    .attendance-card {
        background: white;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    /* Header Styles */
    .top-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header-left h1 {
        margin: 0;
        font-size: 1.8rem;
        font-weight: 600;
    }

    .header-right {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .time-display {
        text-align: right;
        font-size: 0.9rem;
        opacity: 0.9;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.9rem;
    }

    /* Navigation Bar */
    .navbar {
        background: white;
        border-bottom: 1px solid #e0e0e0;
        padding: 0 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
    }

    .navbar-left {
        display: flex;
        gap: 30px;
    }

    .navbar .nav-item {
        color: #666;
        text-decoration: none;
        padding: 8px 16px;
        border-radius: 6px;
        transition: all 0.2s ease;
        font-weight: 500;
        border-left: none;
    }

    .navbar .nav-item:hover {
        background-color: #f1f3f4;
        color: #1a73e8;
    }

    .navbar .nav-item.active {
        background-color: #e8f0fe;
        color: #1a73e8;
        border-left: none;
    }

    /* Button styles */
    .btn-secondary {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: white;
    }

    .table-responsive {
        overflow-x: auto;
    }

    .pager {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .pager-select {
        padding: 6px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
    }

    .pager-btn {
        padding: 6px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        cursor: pointer;
        color: #333;
        font-weight: 500;
    }

    .pager-btn:hover {
        background: #f1f3f4;
        color: #1a73e8;
    }

    .pager-btn:disabled {
        background: #f1f3f5;
        color: #98a2b3;
        cursor: not-allowed;
        box-shadow: none;
    }

    .pager-page {
        padding: 6px 12px;
        color: #333;
        font-weight: 600;
    }

</style>
</head>
<body>

<!-- Top Header -->
<div class="top-header">
    <div class="header-left">
        <h1><i class="fas fa-chart-line"></i> Attendance Summary</h1>
    </div>
    <div class="header-right">
        <div class="time-display">
            <div id="current-time"></div>
            <div id="current-date"></div>
        </div>
        <div class="user-info">
            <i class="fas fa-user-circle"></i>
            <span>{{ user.first_name }} {{ user.last_name }}</span>
        </div>
    </div>
</div>

<!-- Navigation Bar -->
<nav class="navbar">
    <div class="navbar-left">
        <a href="/dashboard" class="nav-item">Home</a>
        <a href="#" class="nav-item">Administrative Personnel</a>
        <a href="/attendance" class="nav-item active">Attendance</a>
        <a href="#" class="nav-item">Salary</a>
        <a href="#" class="nav-item">Decision</a>
    </div>
</nav>

<div class="sidebar" id="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
        <h2 class="sidebar-title">
            <i class="fas fa-clock"></i>
            Attendance Management
        </h2>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar-nav">
        <div class="nav-section">
            <h3 class="nav-section-title">Attendance Management</h3>
            <a href="/attendance/monthly_attendance_detail" class="nav-item">
                <div class="nav-item-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <span class="nav-item-text">Monthly Attendance Detail</span>
            </a>
            <a href="/attendance/attendance_summary" class="nav-item active">
                <div class="nav-item-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <span class="nav-item-text">Attendance Summary</span>
            </a>
            <a href="/attendance/work_data" class="nav-item">
                <div class="nav-item-icon">
                    <i class="fas fa-database"></i>
                </div>
                <span class="nav-item-text">Work Data</span>
            </a>
        </div>
    </nav>
</div>

<!-- Sidebar Toggle Button -->
<button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
    <i class="fas fa-chevron-left"></i>
</button>

<div class="main-content-with-sidebar">
    <div class="content-area">
        <div class="attendance-container">
            <div class="attendance-card">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">
                    <i class="fas fa-chart-line"></i> Attendance Summary
                </h2>
                
                <!-- Actions Row -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <div style="display:flex; gap: 10px; align-items: center;">
                        <button id="openFilterBtn" class="btn-secondary" style="background:#6c757d;">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                        <input id="boardSearchInput" type="text" placeholder="Search attendance boards..." 
                               style="padding:10px 12px; border:1px solid #ddd; border-radius:6px; width:260px;"/>
                    </div>
                    <button id="createBoardBtn" class="btn-secondary" style="background:#28a745;">
                        <i class="fas fa-plus"></i> Add New
                    </button>
                </div>

                <!-- Filter Panel -->
                <div id="boardFilterPanel" style="display:none; background:#f8f9fa; border:1px solid #eee; border-radius:8px; padding:16px; margin-bottom:16px;">
                    <div style="display:grid; grid-template-columns: repeat(6, 1fr); gap:12px;">
                        <div>
                            <label style="font-weight:600; color:#2c3e50; font-size:0.9rem;">From Date</label>
                            <input id="boardFromDate" type="date" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;"/>
                        </div>
                        <div>
                            <label style="font-weight:600; color:#2c3e50; font-size:0.9rem;">To Date</label>
                            <input id="boardToDate" type="date" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;"/>
                        </div>
                        <div>
                            <label style="font-weight:600; color:#2c3e50; font-size:0.9rem;">Department</label>
                            <input id="boardUnit" type="text" placeholder="e.g. Sales Department" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;"/>
                        </div>
                        <div>
                            <label style="font-weight:600; color:#2c3e50; font-size:0.9rem;">Type</label>
                            <select id="boardType" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">
                                <option value="">All</option>
                                <option value="monthly">Monthly</option>
                                <option value="period">Period</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-weight:600; color:#2c3e50; font-size:0.9rem;">Status</label>
                            <select id="boardStatus" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">
                                <option value="">All</option>
                                <option value="draft">Draft</option>
                                <option value="processing">Processing</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div style="display:flex; align-items:flex-end; gap:10px;">
                            <button id="applyBoardFilterBtn" class="btn-secondary" style="background:#3498db;">
                                Apply
                            </button>
                            <button id="resetBoardFilterBtn" class="btn-secondary" style="background:#6c757d;">
                                Reset
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Table Container -->
                <div class="table-responsive" style="min-height:240px;">
                    <table style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background:#f8f9fa;">
                                <th style="padding:10px; border-bottom:1px solid #e9ecef; text-align:left;">Attendance Board Name</th>
                                <th style="padding:10px; border-bottom:1px solid #e9ecef; text-align:left;">From Date</th>
                                <th style="padding:10px; border-bottom:1px solid #e9ecef; text-align:left;">To Date</th>
                                <th style="padding:10px; border-bottom:1px solid #e9ecef; text-align:left;">Department</th>
                                <th style="padding:10px; border-bottom:1px solid #e9ecef; text-align:left;">Type</th>
                                <th style="padding:10px; border-bottom:1px solid #e9ecef; text-align:left;">Status</th>
                                <th style="padding:10px; border-bottom:1px solid #e9ecef; text-align:left;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="timesheetBoardsBody">
                            <tr>
                                <td colspan="7" style="padding:20px; text-align:center; color:#666;">No data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div style="display:flex; justify-content: space-between; align-items:center; margin-top:12px;">
                    <div style="color:#666; font-size:0.9rem;">Total records: <span id="boardsTotal">0</span></div>
                    <div class="pager">
                        <select id="boardsPageSize" class="pager-select">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                        <button id="boardsFirst" class="pager-btn" title="First page">«</button>
                        <button id="boardsPrev" class="pager-btn" title="Previous page">‹</button>
                        <span id="boardsPage" class="pager-page">1</span>
                        <button id="boardsNext" class="pager-btn" title="Next page">›</button>
                        <button id="boardsLast" class="pager-btn" title="Last page">»</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Update time display
function updateTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-US');
    const dateString = now.toLocaleDateString('en-US');
    
    document.getElementById('current-time').textContent = timeString;
    document.getElementById('current-date').textContent = dateString;
}

// Initialize and update time every second
updateTime();
setInterval(updateTime, 1000);

// Summary/Boards functionality
let boardsPage = 1;
function getBoardsPageSize() {
    const sel = document.getElementById('boardsPageSize');
    return sel ? parseInt(sel.value, 10) : 10;
}

function buildBoardsQuery() {
    const params = new URLSearchParams();
    params.set('page', boardsPage);
    params.set('page_size', getBoardsPageSize());
    const q = document.getElementById('boardSearchInput')?.value || '';
    const unit = document.getElementById('boardUnit')?.value || '';
    const type = document.getElementById('boardType')?.value || '';
    const status = document.getElementById('boardStatus')?.value || '';
    const fromDate = document.getElementById('boardFromDate')?.value || '';
    const toDate = document.getElementById('boardToDate')?.value || '';
    if (q) params.set('q', q);
    if (unit) params.set('unit', unit);
    if (type) params.set('type', type);
    if (status) params.set('status', status);
    if (fromDate) params.set('from_date', fromDate);
    if (toDate) params.set('to_date', toDate);
    return params.toString();
}

function loadTimesheetBoards() {
    const query = buildBoardsQuery();
    console.log('Loading timesheet boards with query:', query);
    
    // Mock data for demonstration - replace with actual API call
    const mockData = {
        total: 0,
        data: []
    };
    
    renderBoardsTable(mockData);
}

function renderBoardsTable(response) {
    const tbody = document.getElementById('timesheetBoardsBody');
    const totalSpan = document.getElementById('boardsTotal');
    
    if (totalSpan) totalSpan.textContent = response.total || 0;
    
    if (!tbody) return;
    
    if (!response.data || response.data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="padding:20px; text-align:center; color:#666;">No data available</td></tr>';
        return;
    }
    
    tbody.innerHTML = response.data.map(board => `
        <tr style="border-bottom:1px solid #f1f3f5;">
            <td style="padding:12px 10px;">${board.name || ''}</td>
            <td style="padding:12px 10px;">${board.from_date || ''}</td>
            <td style="padding:12px 10px;">${board.to_date || ''}</td>
            <td style="padding:12px 10px;">${board.unit || ''}</td>
            <td style="padding:12px 10px;">${board.type || ''}</td>
            <td style="padding:12px 10px;">
                <span style="padding:4px 8px; border-radius:12px; font-size:0.8rem; font-weight:500; 
                    background:${board.status === 'completed' ? '#d4edda' : board.status === 'processing' ? '#fff3cd' : '#f8d7da'};
                    color:${board.status === 'completed' ? '#155724' : board.status === 'processing' ? '#856404' : '#721c24'};">
                    ${board.status || 'Unknown'}
                </span>
            </td>
            <td style="padding:12px 10px;">
                <button onclick="editBoard(${board.id})" style="padding:4px 8px; margin-right:4px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">
                    <i class="fas fa-edit"></i>
                </button>
                <button onclick="deleteBoard(${board.id})" style="padding:4px 8px; background:#dc3545; color:white; border:none; border-radius:4px; cursor:pointer;">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>
    `).join('');
}

// Event listeners
document.getElementById('openFilterBtn')?.addEventListener('click', function() {
    const panel = document.getElementById('boardFilterPanel');
    if (panel) {
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }
});

document.getElementById('applyBoardFilterBtn')?.addEventListener('click', function() {
    boardsPage = 1;
    loadTimesheetBoards();
});

document.getElementById('resetBoardFilterBtn')?.addEventListener('click', function() {
    document.getElementById('boardSearchInput').value = '';
    document.getElementById('boardUnit').value = '';
    document.getElementById('boardType').value = '';
    document.getElementById('boardStatus').value = '';
    document.getElementById('boardFromDate').value = '';
    document.getElementById('boardToDate').value = '';
    boardsPage = 1;
    loadTimesheetBoards();
});

document.getElementById('boardSearchInput')?.addEventListener('keyup', function(e) {
    if (e.key === 'Enter') {
        boardsPage = 1;
        loadTimesheetBoards();
    }
});

// Pagination handlers
document.getElementById('boardsFirst')?.addEventListener('click', function() {
    boardsPage = 1;
    loadTimesheetBoards();
});

document.getElementById('boardsPrev')?.addEventListener('click', function() {
    if (boardsPage > 1) {
        boardsPage--;
        loadTimesheetBoards();
    }
});

document.getElementById('boardsNext')?.addEventListener('click', function() {
    boardsPage++;
    loadTimesheetBoards();
});

document.getElementById('boardsPageSize')?.addEventListener('change', function() {
    boardsPage = 1;
    loadTimesheetBoards();
});

// Action functions
function editBoard(id) {
    console.log('Edit board:', id);
    // Implement edit functionality
}

function deleteBoard(id) {
    if (confirm('Are you sure you want to delete this attendance board?')) {
        console.log('Delete board:', id);
        // Implement delete functionality
    }
}

// Sidebar toggle functionality
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.querySelector('.main-content-with-sidebar');
    const toggleButton = document.getElementById('sidebarToggle');
    
    sidebar.classList.toggle('collapsed');
    mainContent.classList.toggle('sidebar-collapsed');
    toggleButton.classList.toggle('collapsed');
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadTimesheetBoards();
});
</script>

</body>
</html>
